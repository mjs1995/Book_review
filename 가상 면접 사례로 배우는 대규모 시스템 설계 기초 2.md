- 좋은 설계는 운영 관리의 편의성, 비용, 개선 및 개발 용이성 등의 다양한 주제를 오랜 시간 동안 고단하고 탐구한 끝에 탄생함

# 근접성 서비스
- 문제 이해 및 설계 범위 확정
  - 비기능 요구사항
    - 낮은 응답 지연(latency) : 사용자는 주변 사업장을 신속히 검색할 수 있어야 함
    - 데이터 보호(data privacy) : 사용자 위치는 민감한 정보. 위치 기반 서비스(LBS)를 설계할 때는 언제나 사용자의 정보를 보호할 방법을 고려해야 함. GDPR,CCPA 같은 데이터 사생활 보호 법안을 준수하도록 해야 함
    - 고가용성(high availability) 및 규모 확장성(scalability) 요구사항 : 인구 밀집 지역에서 이용자가 집중되는 시간에 트래픽이 급증해도 감당할 수 있도록 시스템을 설계해야 함 
- 개략적 설계안 제시 및 동의 구하기
  - API 설계
    - 사업장 관련 API
      - GET : 특정 사업장의 상세 정보 반환
      - POST : 새로운 사업장 추가
      - PUT : 사업장 상세 정보 갱신
      - DELETE : 특정 사업장 정보 삭제
  - 데이터 모델
    - 읽기 연산이 압도적인 시스템에는 MySQL 같은 관계형 데이터베이스가 바람직할 수 있음
  - 개략적 설계
    - 로드밸런서
      - 유입 트래픽을 자동으로 여러 서비스에 분산시키는 컴포넌트
      - 통상적으로 로드밸런서를 사용하는 회사는 로드밸런서에 단일 DNS 진입점(entry point)을 지정하고, URL 경로를 분석하여 어느 서비스에 트래픽을 전달할지 결정함 
    - 데이터베이스 클러스터
      - 주 데이터베이스는 쓰기 요청을 처리하며, 부 데이터 베이스, 즉 사본 데이터베이스는 읽기 요청을 처리함 
    - 주변 사업장 검색 알고리즘
      - 해시 기반 방안: 균등 격자, 지오해시, 카르테시안 계층 등
      - 트리 기반 방안 : 쿼드트리, 구글 S2, R 트리 등
      - 지도를 작은 영역으로 분할하고 고속 검색이 가능하도록 색인을 만드는것. 지오해시, 쿼드트리, 구글 S2는 실제로 가장 널리 사용되는 방안 
- 상세 설계
  - 지역 및 가용성 구역
    - 기대 효과
      - 사용자와 시스템 사이의 물리적 거리를 최소한으로 줄일 수 있음. 미국 서부 사용자는 해당 지역 데이터 센터로 연결될 것이고, 유럽 사용자는 유럽 데이터 센터로 연결될 것
      - 트래픽을 인구에 따라 고르게 분산하는 유연성을 확보할 수 있음. 일본과 한국 같은 지역은 인구 밀도가 아주 높음. 그런 국가는 별도 지역으로 빼거나, 아예 한 지역 안에서도 여러 가용성 구역을 활용하여 부하를 분산시키는 것이 바람직할 수 있음 
      - 어떤 국가는 사용자 데이터를 해당 국가 이외의 지역으로 전송하지 못하도록 함. 그런 경우에는 해당 국가를 별도 지역으로 빼고, 해당 국가에서 발생하는 모든 트래픽은 DNS 라우팅을 통해 해당 지역 내 서비스가 처리하도록 해야 함 

# 주변 친구
- 개략적 설계안 제시 및 동의 구하기
  - RESTful API 서버
    - 무상태(stateless) API 서버의 클러스터로서, 통상적인 요청/응답 트래픽을 처리함 
  - 레디스 위치 정보 캐시
    - 레디스에 보관하는 캐시 항목에는 TTL(Time-To-Live) 필드가 있음. 이 기간이 지나면 해당 사용자는 비활성 상태로 바뀌고 그 위치 정보는 캐시에서 삭제됨
  - 레디스 펍/섭 서버
    - 레디스 펍/섭은 초경량 메시지 버스. 레디스 펍/섭에 새로운 채널을 생성하는 것은 아주 값싼 연산 
- 상세 설계
  - 레디스 펍/섭 서버
    - 구독자가 없는 채널로 전송된 메시지는 그대로 버려지는데, 그 과정에서 서버에 가해지는 부하는 거의 없음
    - 채널 하나를 유지하기 위해서는 구독자 관계를 추적하기 위해 해시 테이블과 연결 리스트가 필요한데 아주 소량의 메모리만을 사용함 

# 구글 맵
- 상세 설계
  - 카프카는 응답 지연이 낮고 많은 데이터를 동시에 처리할 수 있는 데이터 스트리밍 플랫폼으로, 실시간 데이터 피드를 지원하기 위해 고안되었음 
