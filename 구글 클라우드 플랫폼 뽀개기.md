# 서평
- 이 책은 GCP에 어떤 서비스들이 있고 서비들을 어떻게 사용해야 하는지 하나하나 실습을 통해 알려주고 있습니다. 또한 서비스들의 역할이 무엇인지, 어떻게 사용하는지에 대해서 자세하게 설명해주고 있습니다.

# Google Cloud Platform
- 클라우드 서비스 
  - 서버나 스토리지 같은 자원이 필요할 때 이를 구글이나 아마존, 마이크로소프트와 같은 벤더로부터 빌려서 사용하고, 사용한 만큼의 비용을 지불하는 서비스 
  - 클라우드가 아닌 기존의 방식
    - 서버를 운영한다면, 서버를 직접 구입 및 임대하여 데이터 센터(IDC)에 입주시키는 방식을 사용해야함. 서비스를 위한 서버가 IDC 내부에 설치되기 때문에 초기에 서버 구입 및 임대에 큰 비용이 발생하고, 설치 및 세팅을 위한 시간도 발생함 
    - 장애가 발생하여 서버 접속이 되지 않으면 직접 IDC를 방문해서 처리해함  
    - 서비스 규모가 커져서 업그레이드를 하기 위해서도 추가 서버나 스토리지를 구매하여 직접 IDC에 방문해 물리적으로 업그레이드를 해야 했음
    - 구매한 서버를 더 이상 필요로 하지 않게 되었을 경우 부채로 남게됨 
  - 클라우드 서비스 방식
    - 서버가 필요할 경우 클라우드 콘솔에 접속해서 바로 VM 인스턴스를 생성해서 사용하면 됨 
    - 서비스가 커져서 업그레이드가 필요한 경우에도 콘솔 내에서 바로 업그레이드를 할 수 있으며, 서비스를 종료하지 않고도 가능함 
    - 더 이상 해당 서버가 필요 없어질 경우에는 바로 인스턴스를 종료하거나 삭제하면 됨 
  - IaaS : 컴퓨팅, 네트워킹, 스토리지 및 기타 인프라 자원을 빌려서 사용할 수 있기 때문에 개발자는 자기 입맛대로 서비스를 구축하여 사용할 수 있음(Compute Engine, Cloud Virtual Network, Cloud DNS 등) 
  - PaaS : 서비스 개발 시 필요로 하는 플랫폼을 제공하기 때문에 개발자는 이러한 플랫폼을 이용하여 미들웨어나 프레임워크를 설치하지 않고도 보다 쉽게 서비스를 구축할 수 있음(App Engine, CloudSQL 등) 
  - SaaS : 클라우드 환경에서 운영되는 소프트웨어로 모든 소프트웨어가 클라우드 내에서 이뤄지기 때문에 별도의 소프트웨어를 설치하거나 개발할 필요가 없음 
- GCP 내 대표적인 서비스 
  - |서비스 명| 설명|
    |:--:|:--:|
    |Compute Engine|확장 가능한 고성능 VM 인스턴스|
    |App Engine|웹 애플리케이션 배포 및 웹 호스팅
    |Cloud Storage|글로벌 에지 캐싱을 제공하는 객체 Repository
    |Cloud SQL|MySQL과 PostgreSQL
    |BigQuery|머신 러닝이 내장되어 있으며 확장성이 우수한 완전 관리형 데이터 웨어 하우스 
    |Cloud Dataproc|관리자 하둡과 스파크 서비스 
    |Cloud PubSub|메시지 큐잉 서비스
    |Kubernetes Engine|쿠버네티스를 사용한 컨테이너 기반 서비스 구축 
    |Cloud Dataflow|실시간 배치 처리 및 스트림 데이터 처리
    |Cloud Functions|이벤트 기반 서버리스 컴퓨팅 플랫폼
    |Stackdriver|통합 모니터링 서비스
    |Cloud Source Repositories|관리형 버전 관리 서비스 
    |Cloud Dataprep|분석을 위해 데이터를 탐색, 정리, 준비해주는 클라우드 데이터 서비스 
    |Cloud Composer|아파치 에어플로우를 기반으로 하는 관린형 워크플로 서비스 
    |Cloud AutoML|고품질의 커스텀 머신 러닝 모델을 편하게 학습시켜주는 서비스 
    |Cloud ML Engine|머신 러닝 서비스
    |Cloud Natural Language|자연어 분석 서비스 
    |Cloud Speech-to-Text|음성을 텍스트로 변환해주는 서비스
    |Cloud Text-to-Speech|텍스트를 음성으로 변환해주는 서비스 
    |Cloud Translation|구글의 대표적인 서비스인 구글 번역기와 동일한 서비스 
    |Cloud Vision|이미지 분석 서비스 
    |Cloud IAM|ID 및 액세스 관리 서비스 
    |Persistent Disk|VM 인스턴스용 블록 Repository
    |Knative|서버리스로 빌드, 배포, 관리할 수 있는 Kubernetes 서비스 
    |Cloud Bigtable|NoSQL 데이터베이스
    |Cloud Memorystore|Redis 기반의 인-메모리 DB 서비스 
    |Google Data Studio|데이터 시각화 서비스 

# 기본 개념 
- GCP 리소스(데이터 센터)
  - GCP는 전 세계 곳곳의 구글 데이터 센터에 위치한 컴퓨터와 하드 디스크 같은 물리적 가상 머신과 같은 가상 리소스로 구성됨 
  - 큰 대륙 규모를 리전이라 하는데 리전 내부에도 물리적으로 지역이 나뉘며 이를 존이라 함 
  - 각 영역은 Region - Detail Region - Zone으로 구성되며, 예를 들어 동아시에 있는 aZone은 asia-east1-a로 표기됨. 리소스 분포를 통해 장애 대비, 지연 감소 등의 이점을 얻을 수 있음 
- Global, Region, Zone 리소스 
  - 여러 리존과 존에 접근이 가능한 리소스도 있지만, 같은 지역에 위치한 리소스에서만 접근을 할 수도 있음 
- GCP 클라우드 콘솔
  - 클라우드 쉘(Cloud Shell), GCP용 브라우저 기반 대화형 쉘 환경을 제공함 
  - 클라우드 쉘은 바쉬(Bash), 빔(Vim), Python, 자바, 고, 도커, 클라우드 SDK(gcloud)와 같은 자주 사용하는 도구 및 언어들이 미리 설치되어 있기 때문에 별도의 설치 없이 CLI 명령어를 통해 GCP 내의 리소스에 명령을 내릴 수 있음 
  - 클라우드 쉘이 제공하는 기능
    - 웹 브라우저에서 인스턴스에 명령줄로 액세스
    - 기본 제공 코드 편집기(Vim, 이맥스(Emacs))
    - 5GB의 영구 디스크 Repository
    - 사전 설치된 구글 클라우드SDK 및 기타 도구 
    - Java, Go, Python, Node.js, PHP, Ruby, .NET 같은 언어 지원 
    - 웹 미리보기 기능 
    - GCP 콘솔 프로젝트 및 리소스 액세스를 위한 자체 승인 기능 
- 클라우드 SDK(gcloud)
  - GCP는 웹 기반의 GUI 환경인 GCP 클라우드 콘솔 이외에도 터미널에서 명령을 통해 GCP에 액세스 할 수 있는 gcloud라는 CLI 도구를 지원함 
  - gcloud를 이용하면 명령어로 GCP 내의 모든 리소스를 사용할 수 있음 
- 클라이언트 라이브러리
  - 구글 클라우드 클라이언트(Google Cloud Client) 라이브러리는 구글 클라우드 API를 호출하기 위한 클라이언트 라이브러리 

# Cloud IAM
- Cloud IAM(Identity and Access Management)은 구글 클라우드 서비스의 ID 및 액세스 관리를 할 수 있도록 제공해주는 서비스로 누가(ID) 어떤 리소스(GCP Service)에 대한 어떤 액세스 권한(Role)을 갖는지 제어할 수 있게 함 
- 관리자는 누가, 언제, 어떤 리소스에 접근하여 이용하는지에 대한 제어를 할 수 있어서 클라우드 리소스를 중앙에서 쉽게 관리할 수 있음. 복잡한 조직 구조, 많은 작업 그룹과 프로젝트를 지닌 기업에서도 조직 전체에 적용되는 통합 보기를 제공하고, 규정 준수 프로세스를 간편하게 돕는 감사 기능이 내장되어 있음 
- Cloud IAM에서 정책을 만들면 IAM에서 사용하는 ID별로 역할을 줄 수 있는데, 이는 GCP 내의 리소스 별로 개별 설정할 수 있음 
- IAM 정책(IAM Policy) 
  - Cloud IAM 정책은 사용자에게 부여되는 액세스 권한의 유형을 가지고 있는 리스트 
  - 정책은 역할별 해당 역할에 대한 권한을 가진 멤버 리스트로 구성되며, 사용자가 리소스에 액세스할 때 정책을 통해 액세스 제어를 함 
  - IAM Policy 객체는 Json 형태의 목록으로 구성됨
    - bindings
    - role
    - members
    - 구글 계정(user)
    - 서비스 어카운트(serviceAccount)
    - 구글 그룹(group:)
    - G Suite or Cloud ID 도메인(domain:) 
- 정책 계층 구조
  - 조직(Organization) 노드는 계층 구조의 루트 노드이고, 프로젝트 조직의 하위 항목이며, 기타 리소스는 프로젝트의 하위 항목임. 각 리소스는 단 하나의 상위 항목만을 가짐 
  - Cloud IAM 정책은 조직, 폴더, 프로젝트, 리소스 등 리소스 계층 구조의 모든 수준에 설정할 수 있음 
- Cloud IAM의 역할
  - |역할 이름|역할 칭호|권한|
    |:---:|:---:|:---:|
    |roles/owner|소유자|프로젝트 및 프로젝트 내의 모든 리소스에 대한 역할 및 관리, 프로젝트에 대한 결제 설정|
    |roles/editor|편집자|뷰어 권한에 리소스 변경과 같이 상태 변경 작업까지 포함이 됨|
    |roles/viewer|뷰어|읽기 전용 작업에 대한 권한이 부여됨. 기존 리소스 또는 데이터의 조회가 여기에 해당됨|
  - 커스텀 역할 : 사용자가 직접 정의하며 하나 이상의 역할을 결합할 수 있음 
- 서비스 계정
  - 서비스 계정은 사용자가 아닌 애플리케이션 또는 가상 머신에 속한 계정으로 애플리케이션은 사용자 계정이 아닌 서비스 계정을 이용하여 GCP API에 접근함 
  - 서비스 계정 고유의 이메일 주소로 식별이됨 
    - ID로 사용 : 서비스 계정에 역할을 부여하여 프로젝트와 같은 리소스에 액세스되게 할 수 있음 
    - 리소스로 사용: 사용자에게 해당 서비스 계정에 액세스할 권한을 부여할 수 있음 
  - 서비스 계정 키 
    - 각 서비스의 계정은 서비스 계정 키 쌍과 연결이 되며 서비스 계정 키에는 2가지 유형이 있음 
      - GCP 관리: GCP에서 서비스 간 인증에 사용됨. 각 키의 순환 주기는 약 일주일 정도 
      - 사용자 관리: 새로운 키를 만들면 비공개 키(구글에서 보관하지 않기 때문에 다시 다운로드 불가)를 다운로드하게 됨. 서비스 계정 당 최대 10개의 서비스 계정 키를 만들 수 있으며, 10년이 지나면 자동으로 만료됨 

# Compute Engine
- Compute Engine은 GCP에서 제공하는 가상 머신 서비스로 AWS의 EC2에 해당하는 서비스로 다양한 인스턴스 구성 및 이미지를 제공합니다 
- 지원하는 OS이미지로는 데비안(Debian), CentOS, 우분투(Ubuntu), 수세(SUSE), 레드햇(Red Hat), 윈도우 서버(Windows Server) 등이 있음
- Compute Engine은 소프트웨어 또는 업데이트와 같은 호스트 시스템 이벤트가 발생하더라도, VM 인스턴스가 계속 실행될 수 있게 해주는 라이브 이전 기능을 제공함. 사용자는 VM을 재부팅할 필요 없이 동일 영역에서 실행 중인 인스턴스를 또 다른 호스트로 라이브 이전할 수 있음 
- 머신 유형
  - 메모리,vCPU,디스크 등을 포함하여 인스턴스에 제공할 수 있는 가상화된 하드웨어 리소스 모음을 지정함
  - 커스텀 머신 유형: 인스턴스 생성 시 사용할 vCPU 수와 메모리 용량 등 머신 유형을 설정할 수 있음 
  - 이미지 
    - Compute Engine에서는 구글에서 제공하는 운영체제 이미지를 사용하여 인스턴스의 부팅 디스크를 만들 수 있고, 공개 이미지와 커스텀 이미지가 있음.
    - 공개 이미지는 구글, 오픈소스 커뮤니티, 제 3자 공급업체에서 제공하고 관리함 
    - 커스텀 이미지는 사용자의 프로젝트에서만 사용할 수 있는 이미지로 부팅 디스크 및 다른 이미지에서 커스텀 이미지를 생성한 다음에 해당 이미지를 이용하여 인스턴스를 만들 수 있음 
- 실시간 이전(Live Migration)
  - Compute Engine은 소프트웨어 또는 하드웨어 업데이트와 같은 호스트 시스템 이벤트가 발생하더라도 인스턴스를 종료 및 재부팅할 필요 없이 계속 실행시키는 실시간 이전이라는 기능을 제공함 
  - Compute Engine은 사용자가 VM을 재부팅할 필요 없이 동일 영역에서 실행 중인 인스턴스를 또 다른 호스트로 라이브 이전함 
- 선점형 VM 인스턴스(Preemptible VM Instances) 
  - GCP 내에서 아무도 사용하고 있지 않은 리소스를 사용함으로써 일반 인스턴스보다 훨씬 더 저렴한 가격으로 만들고, 실행할 수 있는 인스턴스
  - 제약 사항 
    - Compute Engine은 시스템 이벤트가 발생하면 언제든 선점형 인스턴스를 종료할 수 있음 
    - Compute Engine은 언제나 선점형 인스턴스를 24시간 동안 실행한 후 종료함 
    - 선점형 인스턴스는 한정된 Compute Engine은 리소스이므로 사용하지 못할 수도 있음 
    - 선점형 인스턴스는 유지관리 이벤트 발생 시 Live Migration을 지원하지 않음 
    - 이러한 제한사항 때문에 Google Compute Engine SLA에서 제외됨 
- 인스턴스 템플릿
  - VM 인스턴스 및 인스턴스 그룹을 만드는 데 사용할 수 있는 리소스 
  - 인스턴스 템플릿은 머신 유형, 부팅 디스크 이미지 또는 컨테이너 이미지, 영역, 라벨, 그 외의 속성 등을 이용하여 템플릿을 만들고, 이를 통해서 관리형 인스턴스 그룹이나 개별 VM 인스턴스를 만들 수 있음 
  - 인스턴스 템플릿의 가장 큰 목적은 동일한 구성의 인스턴스를 여러 개 만들기 위해서임 
- 인스턴스 그룹 
  - 관리형 인스턴스 그룹 
    - 관리형 인스턴스 그룹은 인스턴스 템플릿을 사용하여 동일한 인스턴스 그룹을 만들 수 있음 
    - 관리형 인스턴스 그룹은 다양한 장점을 가지는데 그 중 하나가 별다른 설정 없이도 자동으로 오토 스케일링을 지원한다는 것 
    - 애플리케이션 기반의 상태 확인을 이용하는 자동 복구 정책을 설정 할 수 있어서 애플리케이션이 관리형 인스턴스 그룹에 제대로 응답을 하는지 주기적으로 확인하고, 만약 특정 인스턴스에서 문제가 발생하여 정상적으로 응답하지 않으면 인스턴스가 자동으로 다시 생성됨 
    - 관리형 인스턴스 그룹을 사용하면 부하 분산 서비스인 로드 밸런서(Load Balancer)를 붙여서 그룹의 모든 인스턴스에 트래픽을 분산할 수 있음 
    - 새로운 버전의 소프트웨어를 관리형 인스턴스 그룹의 인스턴스에 쉽게 배포할 수 있음. 이를 이용하면 롤링 업데이트, 카나리아 업데이트와 같은 유연한 롤아웃 시나리오를 지원하고, 배포 속도와 범위는 물론 서비스 중단 수준을 제어할 수 있음 
    - 단일 영역에 인스턴스를 배포하는 영역 관리형 인스턴스 그룹 
    - 동일 리전 내 영ㅇ역에 배포하는 리전 관리형 인스턴스 그룹 
      - 애플리케이션의 부하를 여러 영역에 분산시켜 보다 높은 가용성을 제공함. 자연 재해 등의 문제로 특정 영역에서 문제가 발생하더라도 높은 가용성을 유지할 수 있음 
    - 컨테이너를 이용하여 애플리케이션의 배포를 간소화할 수 있음 
  - 비관리형 인스턴스 그룹 
    - 임의로 다른 구성을 가진 인스턴스를 추가하거나 제거할 수 있음. 오토 스케일링, 자동 복구, 롤링 업데이트 지원, 인스턴스 템플릿 사용은 제공하지 않음. 
    - 가용성이 높고 확장 가능한 작업 부하를 배포하는 데는 적합하지 않음 
- 전역(Global), 영역(Region), 지역(Zone)
  - 모든 Compute Engine 리소스는 전역, 지역, 영역 리소스임 
  - 전역 리소스는 모든 지역 또는 영역의 리소스에서 액세스할 수 있어서 서로 다른 영역의 VM 인스턴스가 동일한 전역 이미지를 사용할 수 있음. 지역 리소스는 동일한 지역내의 리소스에서만 액세스할 수 있음 
  - 전역 리소스
    - 전역 리소스는 동일한 프로젝트 내의 모든 영역에 있는 모든 리소스가 액세스 할 수 있음 
    - 주소, 이미지, 스냅샷, 인스턴스 템플릿, VPC 네트워크, 방화벽, 경로, 전역 작업 
  - 지역 리소스 
    - 동일한 지역 내의 모든 리소스가 액세스할 수 있음 
    - 주소, 서브넷, 지역 관리형 인스턴스 그룹, 지역 영구 디스크, 지역 작업 
  - 영역 리소스 
    - 영역에서 호스팅 되는 리소스를 뜻함 
    - 인스턴스 ,영구 디스크, 머신 유형, 영역 관리형 인스턴스 그룹, 영역별 작업 
- 인스턴스 스냅샷
  - 스냅샷은 만들어진 인스턴스의 특정 시접에 백업을 할 수 있음. 스냅샷을 이용하여 백업 시점으로 복수할 수도 있음. 스냅샷을 이용하여 커스텀 이미지를 생성할 수도 있음 
- Marketplace에서 인스턴스 만들기
  - GCP 마켓플레이스에는 바로 사용할 수 있는 솔루션이 설정되어 있는 이미지들을 바로 이용할 수 있음 
  - 이미 설정까지 끝난 이미지를 마켓플레이스에서 바로 생성하여 사용할 수 있음 
- 인스턴스 그룹 만들기(오토 스케일링 적용하기) 
  - 단일 영역 : 인스턴스들이 한 영역(Zone)에 생성이 되기 때문에 지연 시간이 조금이라도 늘어나는 것을 방지할 수 있음 
  - 다중 영역 : 인스턴스가 다양한 영역에 생성이 되기 때문에 특정 영역 전체에서 오작동이 발생할 경우 작업이 실패하는 것을 방지할 수 있음 
  - 관리형 인스턴스 그룹: 동일한 구성의 인스턴스 그룹(오토 스케일링 지원) 
  - 비관리형 인스턴스 그룹: 서로 다른 구성의 인스턴스 그룹(오토 스케일링 미지원)
